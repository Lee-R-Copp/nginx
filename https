# Create self-signed cert
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt

# Create a strong Diffie-Hellman group for enhanced security
openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048

# Create a configuration snippet
nano -w /etc/nginx/snippets/self-signed.conf

  ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;
  ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;

# Create another snippet with SSL settings
nano /etc/nginx/snippets/ssl-params.conf

# SSL Settings - TBD
  
# Replace default site configuration
nano -w /etc/nginx/sites-available/default

# /etc/nginx/sites-available/default  
server
        {
        listen 80;
        listen [::]:80;
        server_name dev.home.lan;
        return 302 https://$server_name$request_uri;
        }

server
        {
        listen 443 ssl;
        listen [::]:443 ssl;
        include snippets/self-signed.conf;
        include snippets/ssl-params.conf;

        server_name dev.home.lan;
        root /var/www/html;
        index index.nginx-debian.html;

        location /
                {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                try_files $uri $uri/ =404;
                }

        }

# Test configuration
nginx -t

# Restart with new configuration
systemctl restart nginx
